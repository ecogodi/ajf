node {
  stage('Setup') {
    sh 'yarn install'
    sh 'yarn add puppeteer'
  }
  stage('Lint') {
    sh 'yarn gulp ci:lint'
  }
  stage('Bazel targets') {
    sh 'bazel build src/... --build_tag_filters=-docs-package'
    sh 'bazel test src/... --build_tag_filters=-docs-package'
    sh 'bazel test tools/public_api_guard/...'
  }
  stage('Unit tests') {
    sh './scripts/circleci/run-local-browser-tests.sh'
  }
  stage('Integration tests') {
    sh 'bazel test e2e-mat/...'
    sh 'bazel test e2e-ion/...'
    sh 'yarn gulp ci:prerender'
  }
  stage('Release output') {
    sh 'yarn gulp ci:build-release-packages'
    sh 'yarn check-release-output'
    sh 'yarn gulp ci:aot'
  }
}
